<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Uitslag - Visclub SiM</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: center;
        }

        .header h1 {
            color: #2c5f7d;
            font-size: 48px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .header .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 8px 20px;
            background: #dc3545;
            color: white;
            border-radius: 20px;
            font-size: 16px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .live-indicator::before {
            content: '';
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .competition-info {
            color: #666;
            font-size: 24px;
            margin-top: 10px;
        }

        .last-update {
            color: #999;
            font-size: 14px;
            margin-top: 10px;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        .stat-card h3 {
            font-size: 48px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-card p {
            color: #666;
            font-size: 18px;
        }

        .results-container {
            display: block;
        }

        .results-table {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .results-table h2 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            font-size: 28px;
            text-align: center;
            margin: 0;
        }

        .results-table-content {
            max-height: 800px;
            overflow-y: auto;
        }

        .result-row {
            display: grid;
            grid-template-columns: 80px 80px 1fr 120px;
            gap: 15px;
            padding: 20px;
            border-bottom: 2px solid #f0f0f0;
            align-items: center;
            transition: all 0.3s;
            animation: slideIn 0.5s;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .result-row:hover {
            background: #f8f9fa;
        }

        .result-row.podium {
            background: linear-gradient(90deg, #fff9e6 0%, #ffffff 100%);
        }

        .result-row.first {
            background: linear-gradient(90deg, #ffd700 0%, #fff9e6 100%);
            border-left: 5px solid #ffd700;
        }

        .result-row.second {
            background: linear-gradient(90deg, #c0c0c0 0%, #fff9e6 100%);
            border-left: 5px solid #c0c0c0;
        }

        .result-row.third {
            background: linear-gradient(90deg, #cd7f32 0%, #fff9e6 100%);
            border-left: 5px solid #cd7f32;
        }

        .rank {
            font-size: 32px;
            font-weight: bold;
            color: #2c5f7d;
            text-align: center;
        }

        .rank.first {
            color: #ffd700;
            font-size: 42px;
        }

        .rank.second {
            color: #c0c0c0;
            font-size: 38px;
        }

        .rank.third {
            color: #cd7f32;
            font-size: 36px;
        }

        .spot {
            font-size: 24px;
            font-weight: bold;
            color: #666;
            text-align: center;
            background: #f0f0f0;
            padding: 8px;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .name {
            font-size: 22px;
            font-weight: 600;
            color: #333;
        }

        .weight {
            font-size: 28px;
            font-weight: bold;
            color: #28a745;
            text-align: right;
        }

        .weight-unit {
            font-size: 18px;
            color: #999;
            margin-left: 5px;
        }

        .no-results {
            padding: 60px;
            text-align: center;
            color: #999;
            font-size: 20px;
        }

        .no-results i {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .trophy-icon {
            margin-right: 10px;
        }

        .trophy-icon.gold {
            color: #ffd700;
        }

        .trophy-icon.silver {
            color: #c0c0c0;
        }

        .trophy-icon.bronze {
            color: #cd7f32;
        }

        /* Scrollbar styling */
        .results-table-content::-webkit-scrollbar {
            width: 10px;
        }

        .results-table-content::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .results-table-content::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 5px;
        }

        .results-table-content::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .complete-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 20px;
            background: #28a745;
            color: white;
            border-radius: 20px;
            font-size: 16px;
            margin-top: 15px;
        }

        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
            transition: all 0.3s;
            z-index: 1000;
        }

        .refresh-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
        }

        .refresh-btn i {
            margin-right: 8px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 32px;
            }

            .results-container {
                grid-template-columns: 1fr;
            }

            .result-row {
                grid-template-columns: 60px 60px 1fr 100px;
                gap: 10px;
                padding: 15px;
            }

            .rank {
                font-size: 24px;
            }

            .name {
                font-size: 18px;
            }

            .weight {
                font-size: 22px;
            }

            .spot {
                font-size: 18px;
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>
                <i class="fas fa-trophy"></i>
                Live Uitslag
                <span class="live-indicator">
                    LIVE
                </span>
            </h1>
            <div class="competition-info" id="competitionInfo">Selecteer een wedstrijd</div>
            <div class="last-update" id="lastUpdate">Laatste update: --:--</div>
        </div>

        <!-- Stats -->
        <div class="stats-bar">
            <div class="stat-card">
                <h3 id="totalWeighed">0</h3>
                <p><i class="fas fa-weight"></i> Gewogen</p>
            </div>
            <div class="stat-card">
                <h3 id="totalParticipants">0 / 43</h3>
                <p><i class="fas fa-users"></i> Deelnemers</p>
            </div>
            <div class="stat-card">
                <h3 id="topWeight">0.000 kg</h3>
                <p><i class="fas fa-fish"></i> Zwaarste Vangst</p>
            </div>
            <div class="stat-card">
                <h3 id="averageWeight">0.000 kg</h3>
                <p><i class="fas fa-balance-scale"></i> Gemiddeld</p>
            </div>
        </div>

        <!-- Results Table -->
        <div class="results-container">
            <div class="results-table" style="max-width: 100%;">
                <h2><i class="fas fa-trophy"></i> Wedstrijd Resultaten - Alle Deelnemers</h2>
                <div class="results-table-content" id="allResults">
                    <div class="no-results">
                        <i class="fas fa-weight"></i>
                        <p>Wacht op wegingen...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Refresh Button -->
    <button class="refresh-btn" onclick="loadResults()">
        <i class="fas fa-sync-alt"></i> Ververs
    </button>

    <script src="script.js"></script>

    <script>
        let currentCompetitionDate = null;
        let weighings = [];
        let autoRefreshInterval = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            findLatestCompetition();
            loadResults();
            startAutoRefresh();
        });

        // Find latest competition with weighings
        function findLatestCompetition() {
            // Load all weighings
            const stored = localStorage.getItem('weighings');
            if (!stored) {
                console.log('No weighings found');
                return;
            }

            weighings = JSON.parse(stored);

            if (weighings.length === 0) {
                console.log('No weighings available');
                return;
            }

            // Get unique competition dates
            const dates = [...new Set(weighings.map(w => w.competitionDate))];

            // Sort by date (most recent first)
            dates.sort((a, b) => {
                const [dayA, monthA, yearA] = a.split('-').map(Number);
                const [dayB, monthB, yearB] = b.split('-').map(Number);
                const dateA = new Date(yearA, monthA - 1, dayA);
                const dateB = new Date(yearB, monthB - 1, dayB);
                return dateB - dateA;
            });

            if (dates.length > 0) {
                currentCompetitionDate = dates[0];

                // Get competition type from first weighing
                const firstWeighing = weighings.find(w => w.competitionDate === currentCompetitionDate);
                if (firstWeighing) {
                    document.getElementById('competitionInfo').textContent =
                        `${currentCompetitionDate} - ${firstWeighing.competitionType}`;
                }
            }
        }

        // Load results
        function loadResults() {
            // Reload weighings
            const stored = localStorage.getItem('weighings');
            if (stored) {
                weighings = JSON.parse(stored);
            }

            if (!currentCompetitionDate || weighings.length === 0) {
                return;
            }

            // Filter weighings for current competition
            const competitionWeighings = weighings.filter(w => w.competitionDate === currentCompetitionDate);

            if (competitionWeighings.length === 0) {
                return;
            }

            // Sort by weight (descending) - ALL results together
            competitionWeighings.sort((a, b) => b.weight - a.weight);

            // Update stats
            updateStats(competitionWeighings);

            // Display all results in one table
            displayResults('allResults', competitionWeighings);

            // Update last update time
            document.getElementById('lastUpdate').textContent =
                `Laatste update: ${new Date().toLocaleTimeString('nl-NL')}`;
        }

        // Update stats
        function updateStats(all) {
            const totalWeighed = all.length;
            document.getElementById('totalWeighed').textContent = totalWeighed;
            document.getElementById('totalParticipants').textContent = `${totalWeighed} / 43`;

            const maxWeight = all.length > 0 ? Math.max(...all.map(w => w.weight)) : 0;
            document.getElementById('topWeight').textContent = maxWeight.toFixed(3) + ' kg';

            const avgWeight = all.length > 0 ? all.reduce((sum, w) => sum + w.weight, 0) / all.length : 0;
            document.getElementById('averageWeight').textContent = avgWeight.toFixed(3) + ' kg';
        }

        // Display results
        function displayResults(containerId, weighings) {
            const container = document.getElementById(containerId);

            if (weighings.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-weight"></i>
                        <p>Wacht op wegingen...</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = weighings.map((w, index) => {
                const rank = index + 1;
                let rankClass = '';
                let trophyIcon = '';

                if (rank === 1) {
                    rankClass = 'first';
                    trophyIcon = '<i class="fas fa-trophy trophy-icon gold"></i>';
                } else if (rank === 2) {
                    rankClass = 'second';
                    trophyIcon = '<i class="fas fa-trophy trophy-icon silver"></i>';
                } else if (rank === 3) {
                    rankClass = 'third';
                    trophyIcon = '<i class="fas fa-trophy trophy-icon bronze"></i>';
                }

                return `
                    <div class="result-row ${rankClass}">
                        <div class="rank ${rankClass}">${trophyIcon}${rank}</div>
                        <div class="spot">${w.spot}</div>
                        <div class="name">${w.name}</div>
                        <div class="weight">
                            ${w.weight.toFixed(3)}
                            <span class="weight-unit">kg</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Auto refresh every 5 seconds
        function startAutoRefresh() {
            autoRefreshInterval = setInterval(() => {
                loadResults();
            }, 5000);
        }

        // Stop auto refresh
        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        }

        // Listen for storage changes (real-time updates from other tabs)
        window.addEventListener('storage', (e) => {
            if (e.key === 'weighings') {
                console.log('Weighings updated, reloading...');
                loadResults();
            }
        });

        // Stop auto-refresh when page is hidden
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                stopAutoRefresh();
            } else {
                startAutoRefresh();
                loadResults();
            }
        });
    </script>
</body>
</html>
