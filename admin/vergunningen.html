html
<!-- Load config first, before any other scripts -->
<script src="config.js"></script>
<!DOCTYPE html><html lang="nl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Visvergunning Aanvragen - Visclub SiM Admin</title><link rel="icon" type="image/x-icon" href="favicon.ico"><link rel="stylesheet" href="admin-style.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"><style>
.permits-container {
max-width: 1400px;
margin: 0 auto;
padding: 20px;
}
.permits-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 30px;
background: white;
padding: 20px;
border-radius: 10px;
box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
.filters {
display: flex;
gap: 10px;
}
.filter-btn {
padding: 8px 16px;
border: 1px solid #ddd;
background: white;
border-radius: 5px;
cursor: pointer;
transition: all 0.3s;
}
.filter-btn.active {
background: #2c5f7d;
color: white;
}
.stats-bar {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 15px;
margin-bottom: 30px;
}
.stat-box {
background: white;
padding: 20px;
border-radius: 10px;
box-shadow: 0 2px 10px rgba(0,0,0,0.1);
text-align: center;
}
.stat-box h3 {
font-size: 32px;
margin: 0 0 5px 0;
color: #2c5f7d;
}
.stat-box p {
margin: 0;
color: #666;
font-size: 14px;
}
.permits-grid {
display: grid;
gap: 15px;
}
.permit-card {
background: white;
padding: 20px;
border-radius: 10px;
box-shadow: 0 2px 10px rgba(0,0,0,0.1);
border-left: 4px solid #ffc107;
transition: all 0.3s;
}
.permit-card.pending {
border-left-color: #ffc107;
}
.permit-card.approved {
border-left-color: #28a745;
}
.permit-card.rejected {
border-left-color: #dc3545;
}
.permit-card:hover {
box-shadow: 0 4px 20px rgba(0,0,0,0.15);
transform: translateY(-2px);
}
.permit-header {
display: flex;
justify-content: space-between;
align-items: start;
margin-bottom: 15px;
}
.applicant-info h4 {
margin: 0 0 5px 0;
color: #333;
font-size: 18px;
}
.applicant-info p {
margin: 0;
color: #666;
font-size: 14px;
}
.permit-status {
padding: 6px 12px;
border-radius: 20px;
font-size: 12px;
font-weight: 600;
}
.status-pending {
background: #fff3cd;
color: #856404;
}
.status-approved {
background: #d4edda;
color: #155724;
}
.status-rejected {
background: #f8d7da;
color: #721c24;
}
.permit-details {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 15px;
margin-bottom: 15px;
padding: 15px;
background: #f8f9fa;
border-radius: 8px;
}
.detail-item {
display: flex;
flex-direction: column;
}
.detail-label {
font-size: 12px;
color: #666;
margin-bottom: 5px;
}
.detail-value {
font-weight: 600;
color: #333;
}
.permit-actions {
display: flex;
gap: 10px;
padding-top: 15px;
border-top: 1px solid #eee;
}
.action-btn {
padding: 8px 16px;
border: none;
border-radius: 5px;
cursor: pointer;
font-size: 14px;
transition: all 0.3s;
display: flex;
align-items: center;
gap: 5px;
}
.action-btn.approve {
background: #28a745;
color: white;
}
.action-btn.reject {
background: #dc3545;
color: white;
}
.action-btn.view {
background: #17a2b8;
color: white;
}
.action-btn.delete {
background: #6c757d;
color: white;
}
.action-btn:hover {
opacity: 0.8;
}
.modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0,0,0,0.5);
z-index: 1000;
align-items: center;
justify-content: center;
}
.modal.active {
display: flex;
}
.modal-content {
background: white;
border-radius: 15px;
max-width: 700px;
width: 90%;
max-height: 80vh;
overflow-y: auto;
box-shadow: 0 10px 40px rgba(0,0,0,0.2);
}
.modal-header {
padding: 25px;
border-bottom: 1px solid #eee;
display: flex;
justify-content: space-between;
align-items: center;
}
.modal-body {
padding: 25px;
}
.modal-footer {
padding: 20px 25px;
border-top: 1px solid #eee;
display: flex;
gap: 10px;
justify-content: flex-end;
}
.close-modal {
background: none;
border: none;
font-size: 24px;
cursor: pointer;
color: #999;
}
</style></head><body><div class="permits-container"><div style="margin-bottom: 20px;"><a href="index.html" style="display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; background: #6c757d; color: white; text-decoration: none; border-radius: 5px; font-weight: 600; transition: background 0.3s;"><i class="fas fa-arrow-left"></i> Terug naar Overzicht
</a></div><div class="permits-header"><div><h1 style="margin: 0 0 5px 0; color: #2c5f7d;"><i class="fas fa-file-contract"></i> Visvergunning Aanvragen
</h1><p style="margin: 0; color: #666;">Beheer en goedkeur visvergunning aanvragen</p></div><div class="filters"><button class="filter-btn active" data-filter="all"><i class="fas fa-list"></i> Alle
</button><button class="filter-btn" data-filter="pending"><i class="fas fa-clock"></i> In afwachting
</button><button class="filter-btn" data-filter="approved"><i class="fas fa-check"></i> Goedgekeurd
</button><button class="filter-btn" data-filter="rejected"><i class="fas fa-times"></i> Afgewezen
</button><button class="filter-btn" data-action="newApplication" style="background: #28a745; color: white; margin-left: auto;"><i class="fas fa-plus"></i> Nieuwe Aanvraag
</button></div></div><div class="stats-bar"><div class="stat-box"><h3 id="totalApplications">0</h3><p>Totaal Aanvragen</p></div><div class="stat-box"><h3 id="pendingApplications" style="color: #ffc107;">0</h3><p>In Afwachting</p></div><div class="stat-box"><h3 id="approvedApplications" style="color: #28a745;">0</h3><p>Goedgekeurd</p></div><div class="stat-box"><h3 id="rejectedApplications" style="color: #dc3545;">0</h3><p>Afgewezen</p></div></div><div class="permits-grid" id="permitsGrid"><div style="text-align: center; padding: 60px 20px; background: white; border-radius: 10px;"><i class="fas fa-file-contract" style="font-size: 64px; color: #ddd; margin-bottom: 20px;"></i><h3 style="color: #999;">Geen aanvragen gevonden</h3><p style="color: #999;">Er zijn nog geen visvergunning aanvragen ontvangen.</p></div></div></div><div class="modal" id="detailsModal"><div class="modal-content"><div class="modal-header"><h2 id="modalTitle" style="margin: 0; color: #2c5f7d;">Aanvraag Details</h2><button class="close-modal" data-action="closeModal"><i class="fas fa-times"></i></button></div><div class="modal-body" id="modalBody"></div><div class="modal-footer" id="modalFooter"></div></div></div>
<script src="admin-auth.js"></script>
<script src="data-api.js"></script>
<script>
        let applications = [];
        let currentApplicationId = null;
        async function init() {
            let retries = 0;
            while (!window.dataAPI && retries < 20) {
                console.log('‚è≥ Waiting for DataAPI to load...');
                await new Promise(resolve => setTimeout(resolve, 100));
                retries++;
            }
            if (!window.dataAPI) {
                console.error('‚ùå DataAPI not available after 2 seconds');
                alert('Data systeem niet beschikbaar. Ververs de pagina.');
                return;
            }
            console.log('‚úÖ DataAPI ready');
            await loadApplications();
            setupFilters();
        }
        document.addEventListener('DOMContentLoaded', init);
        async function loadApplications(filter = 'all') {
            const grid = document.getElementById('permitsGrid');
            try {
                console.log('üìä Loading permits from dataAPI with filter:', filter);
                // Clear cache to force fresh data
                window.dataAPI.cache.permits = null;
                applications = await window.dataAPI.getPermits();
                console.log('üìã Loaded permits:', applications);
                applications = applications.map(app => {
                    if (app.address && typeof app.address === 'object') {
                        return {
                            ...app,
                            street: app.address.street || app.street || '',
                            postal: app.address.postal || app.postal || '',
                            city: app.address.city || app.city || ''
                        };
                    }
                    return app;
                });
                let filteredApplications = applications;
                if (filter !== 'all') {
                    filteredApplications = applications.filter(a => a.status === filter);
                }
                document.getElementById('totalApplications').textContent = applications.length;
                document.getElementById('pendingApplications').textContent = applications.filter(a => a.status === 'pending').length;
                document.getElementById('approvedApplications').textContent = applications.filter(a => a.status === 'approved').length;
                document.getElementById('rejectedApplications').textContent = applications.filter(a => a.status === 'rejected').length;
                if (filteredApplications.length === 0) {
                    grid.innerHTML = `
                        <div style="text-align: center; padding: 60px 20px; background: white; border-radius: 10px;">
                            <i class="fas fa-file-contract" style="font-size: 64px; color: #ddd; margin-bottom: 20px;"></i>
                            <h3 style="color: #999;">Geen aanvragen gevonden</h3>
                            <p style="color: #999;">Er zijn geen aanvragen met dit filter.</p>
                        </div>
                    `;
                    return;
                }
                filteredApplications.sort((a, b) => new Date(b.applicationDate) - new Date(a.applicationDate));
                grid.innerHTML = filteredApplications.map(app => `
                <div class="permit-card ${app.status}" data-permit-id="${app.id}">
                    <div class="permit-header">
                        <div class="applicant-info">
                            <h4><i class="fas fa-user"></i> ${app.firstName} ${app.lastName}</h4>
                            <p><i class="fas fa-envelope"></i> ${app.email} | <i class="fas fa-phone"></i> ${app.phone}</p>
                        </div>
                        <span class="permit-status status-${app.status}">
                            ${getStatusLabel(app.status)}
                        </span>
                    </div>
                    <div class="permit-details">
                        <div class="detail-item">
                            <span class="detail-label">Vergunning Type</span>
                            <span class="detail-value">${getPermitTypeLabel(app.permitType)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Geboortedatum</span>
                            <span class="detail-value">${formatDate(app.birthdate)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Adres</span>
                            <span class="detail-value">${app.street}, ${app.postal} ${app.city}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Aanvraag Datum</span>
                            <span class="detail-value">${formatDateTime(app.applicationDate)}</span>
                        </div>
                    </div>
                    ${app.remarks ? `
                        <div style="padding: 10px; background: #fff3cd; border-radius: 5px; margin-bottom: 15px;">
                            <strong><i class="fas fa-comment"></i> Opmerkingen:</strong>
                            <p style="margin: 5px 0 0 0; color: #666;">${app.remarks}</p>
                        </div>
                    ` : ''}
                    ${app.status === 'approved' ? `
                        <div style="padding: 10px; background: #d4edda; border-radius: 5px; margin-bottom: 15px;">
                            <i class="fas fa-check-circle" style="color: #28a745;"></i>
                            <strong style="color: #155724;">Goedgekeurd</strong>
                            door ${app.approvedBy || 'Admin'} op ${formatDateTime(app.approvedDate)}
                        </div>
                    ` : ''}
                    <div class="permit-actions">
                        <button class="action-btn view" data-action="view" data-id="${app.id}">
                            <i class="fas fa-eye"></i> Bekijken
                        </button>
                        ${app.status === 'pending' ? `
                            <button class="action-btn approve" data-action="approve" data-id="${app.id}">
                                <i class="fas fa-check"></i> Goedkeuren
                            </button>
                            <button class="action-btn reject" data-action="reject" data-id="${app.id}">
                                <i class="fas fa-times"></i> Afwijzen
                            </button>
                        ` : ''}
                        ${app.status === 'approved' ? `
                            <button class="action-btn" style="background: #17a2b8;" data-action="addMember" data-id="${app.id}" data-type="wedstrijd">
                                <i class="fas fa-trophy"></i> + Wedstrijd Lid
                            </button>
                            <button class="action-btn" style="background: #28a745;" data-action="addMember" data-id="${app.id}" data-type="vergunning">
                                <i class="fas fa-fish"></i> + Vergunning Lid
                            </button>
                        ` : ''}
                        <button class="action-btn delete" data-action="delete" data-id="${app.id}">
                            <i class="fas fa-trash"></i> Verwijderen
                        </button>
                    </div>
                </div>
            `).join('');
            } catch (error) {
                console.error('Error loading permits:', error);
                alert('Fout bij laden vergunningen: ' + error.message);
                return;
            }
        }
        function setupFilters() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    loadApplications(this.dataset.filter);
                });
            });
        }
        function viewDetails(id) {
            console.log('üîç viewDetails called with id:', id, typeof id);
            const app = applications.find(a => String(a.id) === String(id));
            if (!app) {
                console.error('‚ùå Application not found with id:', id);
                alert('Aanvraag niet gevonden!');
                return;
            }
            currentApplicationId = id;
            document.getElementById('modalTitle').textContent = `Aanvraag: ${app.firstName} ${app.lastName}`;
            document.getElementById('modalBody').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                    <div>
                        <strong style="color: #666; font-size: 13px;">Voornaam</strong>
                        <p style="margin: 5px 0 0 0;">${app.firstName}</p>
                    </div>
                    <div>
                        <strong style="color: #666; font-size: 13px;">Achternaam</strong>
                        <p style="margin: 5px 0 0 0;">${app.lastName}</p>
                    </div>
                    <div>
                        <strong style="color: #666; font-size: 13px;">Email</strong>
                        <p style="margin: 5px 0 0 0;"><a href="mailto:${app.email}" style="color: #2c5f7d;">${app.email}</a></p>
                    </div>
                    <div>
                        <strong style="color: #666; font-size: 13px;">Telefoon</strong>
                        <p style="margin: 5px 0 0 0;"><a href="tel:${app.phone}" style="color: #2c5f7d;">${app.phone}</a></p>
                    </div>
                    <div>
                        <strong style="color: #666; font-size: 13px;">Straat + Nummer</strong>
                        <p style="margin: 5px 0 0 0;">${app.street}</p>
                    </div>
                    <div>
                        <strong style="color: #666; font-size: 13px;">Postcode</strong>
                        <p style="margin: 5px 0 0 0;">${app.postal}</p>
                    </div>
                    <div>
                        <strong style="color: #666; font-size: 13px;">Gemeente</strong>
                        <p style="margin: 5px 0 0 0;">${app.city}</p>
                    </div>
                    <div>
                        <strong style="color: #666; font-size: 13px;">Geboortedatum</strong>
                        <p style="margin: 5px 0 0 0;">${formatDate(app.birthdate)}</p>
                    </div>
                    <div style="grid-column: 1 / -1;">
                        <strong style="color: #666; font-size: 13px;">Vergunning Type</strong>
                        <p style="margin: 5px 0 0 0; font-weight: 600; color: #2c5f7d;">${getPermitTypeLabel(app.permitType)}</p>
                    </div>
                    ${app.remarks ? `
                        <div style="grid-column: 1 / -1;">
                            <strong style="color: #666; font-size: 13px;">Opmerkingen</strong>
                            <p style="margin: 5px 0 0 0; padding: 10px; background: #f8f9fa; border-radius: 5px;">${app.remarks}</p>
                        </div>
                    ` : ''}
                </div>
            `;
            document.getElementById('modalFooter').innerHTML = `
                ${app.status === 'pending' ? `
                    <button class="action-btn approve" data-action="approve" data-id="${app.id}">
                        <i class="fas fa-check"></i> Goedkeuren & Toevoegen als Lid
                    </button>
                    <button class="action-btn reject" data-action="reject" data-id="${app.id}">
                        <i class="fas fa-times"></i> Afwijzen
                    </button>
                ` : ''}
                <button class="action-btn delete" data-action="delete" data-id="${app.id}">
                    <i class="fas fa-trash"></i> Verwijderen
                </button>
            `;
            const modal = document.getElementById('detailsModal');
            modal.classList.add('active');
            modal.style.display = 'flex';
        }
        function closeModal() {
            const modal = document.getElementById('detailsModal');
            modal.classList.remove('active');
            modal.style.display = 'none';
            currentApplicationId = null;
        }
        async function approveApplication(id) {
            console.log('üîç approveApplication called with id:', id, typeof id);
            const app = applications.find(a => String(a.id) === String(id));
            if (!app) {
                console.error('‚ùå Application not found with id:', id);
                alert('Aanvraag niet gevonden!');
                return;
            }
            if (confirm(`Weet je zeker dat je de aanvraag van ${app.firstName} ${app.lastName} wilt goedkeuren?\n\nDeze persoon wordt automatisch toegevoegd aan de ledenlijst.`)) {
                try {
                    app.status = 'approved';
                    app.approvedBy = adminAuth.getCurrentUser()?.name || 'Admin';
                    app.approvedDate = new Date().toISOString();

                    console.log('üíæ Updating permit status to approved...');
                    await window.dataAPI.updatePermit(id, {
                        status: 'approved',
                        approvedBy: app.approvedBy,
                        approvedDate: app.approvedDate
                    });

                    console.log('üë§ Adding as member...');
                    await addToMembers(app);

                    closeModal();

                    // Reload with current filter
                    const currentFilter = document.querySelector('.filter-btn.active')?.dataset.filter || 'all';
                    console.log('üîÑ Reloading applications with filter:', currentFilter);
                    await loadApplications(currentFilter);

                    alert('‚úÖ Aanvraag goedgekeurd!\n\n' + app.firstName + ' ' + app.lastName + ' is toegevoegd aan de ledenlijst.');
                } catch (error) {
                    console.error('Error approving permit:', error);
                    alert('‚ùå Fout bij goedkeuren vergunning: ' + error.message);
                }
            }
        }
        async function rejectApplication(id) {
            console.log('üîç rejectApplication called with id:', id, typeof id);
            const app = applications.find(a => String(a.id) === String(id));
            if (!app) {
                console.error('‚ùå Application not found with id:', id);
                alert('Aanvraag niet gevonden!');
                return;
            }
            const reason = prompt('Optioneel: Geef een reden voor afwijzing:');
            if (confirm(`Weet je zeker dat je de aanvraag van ${app.firstName} ${app.lastName} wilt afwijzen?`)) {
                try {
                    app.status = 'rejected';
                    app.rejectedBy = adminAuth.getCurrentUser()?.name || 'Admin';
                    app.rejectedDate = new Date().toISOString();
                    app.rejectionReason = reason || '';

                    console.log('üíæ Updating permit status to rejected...');
                    await window.dataAPI.updatePermit(id, {
                        status: 'rejected',
                        rejectedBy: app.rejectedBy,
                        rejectedDate: app.rejectedDate,
                        rejectionReason: app.rejectionReason
                    });

                    closeModal();

                    // Reload with current filter
                    const currentFilter = document.querySelector('.filter-btn.active')?.dataset.filter || 'all';
                    console.log('üîÑ Reloading applications with filter:', currentFilter);
                    await loadApplications(currentFilter);

                    alert('‚ùå Aanvraag afgewezen.');
                } catch (error) {
                    console.error('Error rejecting permit:', error);
                    alert('‚ùå Fout bij afwijzen vergunning: ' + error.message);
                }
            }
        }
        async function deleteApplication(id) {
            console.log('üîç deleteApplication called with id:', id, typeof id);
            const app = applications.find(a => String(a.id) === String(id));
            if (!app) {
                console.error('‚ùå Application not found with id:', id);
                alert('Aanvraag niet gevonden!');
                return;
            }
            if (confirm(`Weet je zeker dat je de aanvraag van ${app.firstName} ${app.lastName} definitief wilt verwijderen?`)) {
                try {
                    console.log('üóëÔ∏è Deleting permit...');
                    await window.dataAPI.deletePermit(id);

                    closeModal();

                    // Reload with current filter
                    const currentFilter = document.querySelector('.filter-btn.active')?.dataset.filter || 'all';
                    console.log('üîÑ Reloading applications with filter:', currentFilter);
                    await loadApplications(currentFilter);

                    alert('‚úÖ Aanvraag verwijderd.');
                } catch (error) {
                    console.error('Error deleting permit:', error);
                    alert('‚ùå Fout bij verwijderen vergunning: ' + error.message);
                }
            }
        }
        async function addToMembers(app) {
            try {
                const birthDate = new Date(app.birthdate);
                const age = Math.floor((new Date() - birthDate) / (365.25 * 24 * 60 * 60 * 1000));
                const isYouth = age < 16;
                const memberData = {
                    firstName: app.firstName,
                    lastName: app.lastName,
                    email: app.email,
                    phone: app.phone,
                    membershipType: isYouth ? 'Jeugd' : 'Jaarlid'
                };
                const newMember = await window.dataAPI.addMember(memberData);
                console.log('‚úÖ Member added:', newMember);
                return newMember;
            } catch (error) {
                console.error('Error adding member:', error);
                throw error;
            }
        }
        async function addAsMember(permitId, type) {
            console.log('üîç addAsMember called with id:', permitId, 'type:', type);
            const app = applications.find(a => String(a.id) === String(permitId));
            if (!app) {
                console.error('‚ùå Application not found with id:', permitId);
                alert('‚ùå Vergunning niet gevonden.');
                return;
            }
            try {
                const existingMembers = await window.dataAPI.getMembers();
                const alreadyExists = existingMembers.some(m =>
                    m.email === app.email ||
                    (m.firstName === app.firstName && m.lastName === app.lastName)
                );
                if (alreadyExists) {
                    alert('‚ö†Ô∏è Deze persoon is al toegevoegd als lid.');
                    return;
                }
                const birthDate = new Date(app.birthdate);
                const age = Math.floor((new Date() - birthDate) / (365.25 * 24 * 60 * 60 * 1000));
                const isYouth = age < 16;
                const isSenior = age >= 65;
                let membershipType;
                if (type === 'wedstrijd') {
                    if (isYouth) {
                        membershipType = 'Jeugd';
                    } else if (isSenior) {
                        membershipType = 'Senior 65+';
                    } else {
                        membershipType = 'Jaarlid';
                    }
                } else {
                    membershipType = 'Dagkaart';
                }
                const memberData = {
                    firstName: app.firstName,
                    lastName: app.lastName,
                    email: app.email,
                    phone: app.phone,
                    membershipType: membershipType,
                    address: `${app.street}, ${app.postal} ${app.city}`,
                    birthdate: app.birthdate
                };
                const newMember = await window.dataAPI.addMember(memberData);
                console.log('‚úÖ Member added:', newMember);
                const typeName = type === 'wedstrijd' ? 'Wedstrijd Lid' : 'Vergunninghouder';
                alert(`‚úÖ ${app.firstName} ${app.lastName} is toegevoegd als ${typeName} (${membershipType})!`);
            } catch (error) {
                console.error('Error adding member:', error);
                alert('‚ùå Fout bij toevoegen lid: ' + error.message);
            }
        }
        function showNewApplicationForm() {
            const modal = document.getElementById('detailsModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            const modalFooter = document.getElementById('modalFooter');
            modalTitle.textContent = 'Nieuwe Vergunning Aanvraag';
            modalBody.innerHTML = `
                <form id="newApplicationForm" style="display: grid; gap: 15px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Voornaam *</label>
                            <input type="text" id="newFirstName" required style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 5px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Achternaam *</label>
                            <input type="text" id="newLastName" required style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 5px;">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Email *</label>
                            <input type="email" id="newEmail" required style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 5px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Telefoon *</label>
                            <input type="tel" id="newPhone" required style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 5px;">
                        </div>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Straat en Nummer *</label>
                        <input type="text" id="newStreet" required style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 5px;">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Postcode *</label>
                            <input type="text" id="newPostal" required style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 5px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Gemeente *</label>
                            <input type="text" id="newCity" required style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 5px;">
                        </div>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Geboortedatum *</label>
                        <input type="date" id="newBirthdate" required style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 5px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Type Vergunning *</label>
                        <select id="newPermitType" required style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 5px;">
                            <option value="">-- Kies type --</option>
                            <option value="jaarvergunning">Jaarvergunning (‚Ç¨75)</option>
                            <option value="jeugdvergunning">Jeugdvergunning -16 jaar (‚Ç¨30)</option>
                            <option value="dagkaart">Dagkaart (‚Ç¨60)</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Opmerkingen</label>
                        <textarea id="newRemarks" rows="3" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 5px;"></textarea>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Status *</label>
                        <select id="newStatus" required style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 5px;">
                            <option value="pending">In Afwachting</option>
                            <option value="approved">Goedgekeurd</option>
                            <option value="rejected">Afgewezen</option>
                        </select>
                    </div>
                </form>
            `;
            modalFooter.innerHTML = `
                <button data-action="closeModal" style="padding: 12px 24px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    <i class="fas fa-times"></i> Annuleren
                </button>
                <button data-action="submitNewApplication" style="padding: 12px 24px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    <i class="fas fa-save"></i> Aanvraag Toevoegen
                </button>
            `;
            modal.style.display = 'flex';
        }
        async function submitNewApplication() {
            const form = document.getElementById('newApplicationForm');
            if (!form.checkValidity()) {
                alert('‚ö†Ô∏è Vul alle verplichte velden in');
                return;
            }
            const newApplication = {
                firstName: document.getElementById('newFirstName').value,
                lastName: document.getElementById('newLastName').value,
                email: document.getElementById('newEmail').value,
                phone: document.getElementById('newPhone').value,
                street: document.getElementById('newStreet').value,
                postal: document.getElementById('newPostal').value,
                city: document.getElementById('newCity').value,
                birthdate: document.getElementById('newBirthdate').value,
                permitType: document.getElementById('newPermitType').value,
                remarks: document.getElementById('newRemarks').value,
                status: document.getElementById('newStatus').value
            };
            try {
                await window.dataAPI.addPermit(newApplication);
                await loadApplications(document.querySelector('.filter-btn.active')?.dataset.filter || 'all');
                closeModal();
                alert('‚úÖ Nieuwe aanvraag succesvol toegevoegd!');
            } catch (error) {
                console.error('Error adding application:', error);
                alert('‚ùå Fout bij toevoegen aanvraag: ' + error.message);
            }
        }
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('nl-NL', { day: 'numeric', month: 'long', year: 'numeric' });
        }
        function formatDateTime(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('nl-NL', {
                day: 'numeric',
                month: 'short',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        function getStatusLabel(status) {
            const labels = {
                'pending': 'In Afwachting',
                'approved': 'Goedgekeurd',
                'rejected': 'Afgewezen'
            };
            return labels[status] || status;
        }
        function getPermitTypeLabel(type) {
            const labels = {
                'year': 'Jaarvergunning (‚Ç¨75)',
                'jaarvergunning': 'Jaarvergunning (‚Ç¨75)',
                'jeugdvergunning': 'Jeugdvergunning -16 jaar (‚Ç¨30)',
                'dagkaart': 'Dagkaart (‚Ç¨60)',
                'competition': 'Wedstrijdvissers (‚Ç¨60)',
                'youth': 'Jongeren (‚Ç¨37,50)'
            };
            return labels[type] || type;
        }
        document.getElementById('detailsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Event delegation for all buttons
        document.addEventListener('click', function(e) {
            const btn = e.target.closest('button[data-action]');
            if (!btn) return;

            const action = btn.dataset.action;
            const id = btn.dataset.id;
            const type = btn.dataset.type;

            console.log('Button clicked:', { action, id, type });

            switch(action) {
                case 'view':
                    viewDetails(id);
                    break;
                case 'approve':
                    approveApplication(id);
                    break;
                case 'reject':
                    rejectApplication(id);
                    break;
                case 'delete':
                    deleteApplication(id);
                    break;
                case 'addMember':
                    addAsMember(id, type);
                    break;
                case 'newApplication':
                    showNewApplicationForm();
                    break;
                case 'closeModal':
                    closeModal();
                    break;
                case 'submitNewApplication':
                    submitNewApplication();
                    break;
            }
        });
    </script>
</body></html>