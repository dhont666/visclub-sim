<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Data Setup - Visclub SiM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }

        h1 {
            color: #2c5f7d;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #2c5f7d;
        }

        .section h2 {
            color: #2c5f7d;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .section p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(40, 167, 69, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-block {
            width: 100%;
            justify-content: center;
            margin-bottom: 15px;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .alert.show {
            display: block;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .info-box {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #0066cc;
            margin-bottom: 20px;
        }

        .info-box h3 {
            color: #0066cc;
            margin-bottom: 10px;
        }

        .info-box ul {
            margin-left: 20px;
            color: #333;
        }

        .info-box li {
            margin-bottom: 5px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: white;
            text-decoration: none;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">
            <i class="fas fa-arrow-left"></i> Terug naar Dashboard
        </a>

        <div class="card">
            <h1><i class="fas fa-database"></i> Demo Data Setup</h1>
            <p class="subtitle">Voeg snel test data toe om het weging systeem uit te proberen</p>

            <div id="alertSuccess" class="alert success">
                <i class="fas fa-check-circle"></i> <span id="alertMessage"></span>
            </div>

            <div class="info-box">
                <h3><i class="fas fa-info-circle"></i> Wat wordt er toegevoegd?</h3>
                <ul>
                    <li><strong>20 Demo Leden</strong> - Jan, Piet, Karel, Marie, etc.</li>
                    <li><strong>1 Wedstrijd</strong> - Vandaag met 15 inschrijvingen</li>
                    <li><strong>1 Plaatsentrekking</strong> - Automatisch voltooid</li>
                    <li><strong>Demo Gewichten</strong> - Optioneel: voeg random gewichten toe</li>
                </ul>
            </div>

            <!-- Step 1: Add Members -->
            <div class="section">
                <h2><i class="fas fa-users"></i> Stap 1: Voeg Demo Leden Toe</h2>
                <p>Dit voegt 20 fictieve leden toe aan je database.</p>
                <button class="btn btn-primary btn-block" onclick="addDemoMembers()">
                    <i class="fas fa-user-plus"></i> Voeg 20 Demo Leden Toe
                </button>
            </div>

            <!-- Step 2: Add Competition & Draw -->
            <div class="section">
                <h2><i class="fas fa-trophy"></i> Stap 2: Maak Wedstrijd + Trekking</h2>
                <p>Dit maakt een wedstrijd van vandaag met 15 inschrijvingen en doet automatisch de plaatsentrekking.</p>
                <button class="btn btn-primary btn-block" onclick="createCompetitionWithDraw()">
                    <i class="fas fa-random"></i> Maak Wedstrijd + Doe Trekking
                </button>
            </div>

            <!-- Step 3: Add Random Weights (Optional) -->
            <div class="section">
                <h2><i class="fas fa-weight"></i> Stap 3: Voeg Demo Gewichten Toe (Optioneel)</h2>
                <p>Dit voegt random gewichten toe aan de getrokken plaatsen (tussen 0.500kg en 5.000kg).</p>
                <button class="btn btn-primary btn-block" onclick="addRandomWeights()">
                    <i class="fas fa-weight-hanging"></i> Voeg Random Gewichten Toe
                </button>
            </div>

            <!-- Quick Actions -->
            <div class="section" style="border-left-color: #28a745;">
                <h2><i class="fas fa-bolt"></i> Snelle Acties</h2>
                <button class="btn btn-primary btn-block" onclick="setupEverything()">
                    <i class="fas fa-magic"></i> Doe Alles in 1 Klik (Leden + Wedstrijd + Gewichten)
                </button>
            </div>

            <!-- Reset -->
            <div class="section" style="border-left-color: #dc3545;">
                <h2><i class="fas fa-trash"></i> Opruimen</h2>
                <p>Verwijder alle demo data (leden, wegingen, trekkingen).</p>
                <button class="btn btn-danger btn-block" onclick="clearAllDemoData()">
                    <i class="fas fa-trash-alt"></i> Verwijder Alle Demo Data
                </button>
            </div>

            <!-- Navigation -->
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <a href="weging.html" class="btn btn-secondary" style="flex: 1;">
                    <i class="fas fa-weight"></i> Ga naar Weging
                </a>
                <a href="../live-uitslag.html" class="btn btn-secondary" style="flex: 1;" target="_blank">
                    <i class="fas fa-tv"></i> Open Live Uitslag
                </a>
            </div>
        </div>
    </div>

    <script src="admin-auth.js"></script>
    <script src="data-api.js"></script>
    <script src="../script.js"></script>

    <script>
        // Check auth
        if (!adminAuth || !adminAuth.checkAuth()) {
            alert('Je moet ingelogd zijn');
            window.location.href = 'login.html';
        }
    </script>

    <script>
        // Demo members
        const demoMembers = [
            { firstName: 'Jan', lastName: 'Janssens', email: 'jan@demo.be', phone: '0471234567', membershipType: 'Jaarlid' },
            { firstName: 'Piet', lastName: 'Pieters', email: 'piet@demo.be', phone: '0472345678', membershipType: 'Jaarlid' },
            { firstName: 'Karel', lastName: 'Klaassen', email: 'karel@demo.be', phone: '0473456789', membershipType: 'Jaarlid' },
            { firstName: 'Marie', lastName: 'De Vries', email: 'marie@demo.be', phone: '0474567890', membershipType: 'Jaarlid' },
            { firstName: 'Dirk', lastName: 'Dirksen', email: 'dirk@demo.be', phone: '0475678901', membershipType: 'Senior' },
            { firstName: 'Eva', lastName: 'Evers', email: 'eva@demo.be', phone: '0476789012', membershipType: 'Jaarlid' },
            { firstName: 'Frank', lastName: 'Franssen', email: 'frank@demo.be', phone: '0477890123', membershipType: 'Jaarlid' },
            { firstName: 'Greet', lastName: 'Goossens', email: 'greet@demo.be', phone: '0478901234', membershipType: 'Jaarlid' },
            { firstName: 'Hans', lastName: 'Hermans', email: 'hans@demo.be', phone: '0479012345', membershipType: 'Jaarlid' },
            { firstName: 'Inge', lastName: 'Ivens', email: 'inge@demo.be', phone: '0480123456', membershipType: 'Jaarlid' },
            { firstName: 'Jos', lastName: 'Jansen', email: 'jos@demo.be', phone: '0481234567', membershipType: 'Jaarlid' },
            { firstName: 'Kris', lastName: 'Koen', email: 'kris@demo.be', phone: '0482345678', membershipType: 'Jaarlid' },
            { firstName: 'Luc', lastName: 'Lemmens', email: 'luc@demo.be', phone: '0483456789', membershipType: 'Jaarlid' },
            { firstName: 'Mieke', lastName: 'Maes', email: 'mieke@demo.be', phone: '0484567890', membershipType: 'Jaarlid' },
            { firstName: 'Nick', lastName: 'Nijs', email: 'nick@demo.be', phone: '0485678901', membershipType: 'Jaarlid' },
            { firstName: 'Olga', lastName: 'Ooms', email: 'olga@demo.be', phone: '0486789012', membershipType: 'Jaarlid' },
            { firstName: 'Peter', lastName: 'Peeters', email: 'peter@demo.be', phone: '0487890123', membershipType: 'Jaarlid' },
            { firstName: 'Quinn', lastName: 'Quirijns', email: 'quinn@demo.be', phone: '0488901234', membershipType: 'Jaarlid' },
            { firstName: 'Rita', lastName: 'Raes', email: 'rita@demo.be', phone: '0489012345', membershipType: 'Jaarlid' },
            { firstName: 'Sam', lastName: 'Smeets', email: 'sam@demo.be', phone: '0490123456', membershipType: 'Jeugd' }
        ];

        // Add demo members
        async function addDemoMembers() {
            try {
                if (!window.dataAPI) {
                    alert('DataAPI niet beschikbaar');
                    return;
                }

                for (const member of demoMembers) {
                    await window.dataAPI.addMember(member);
                }

                showAlert(`âœ… ${demoMembers.length} demo leden toegevoegd!`);
                console.log('Demo members added successfully');
            } catch (error) {
                console.error('Error adding demo members:', error);
                alert('Fout bij toevoegen leden: ' + error.message);
            }
        }

        // Create competition with draw
        async function createCompetitionWithDraw() {
            try {
                // Get tomorrow's date (so it appears as "future" competition in plaatsentrekking)
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const datum = `${String(tomorrow.getDate()).padStart(2, '0')}-${String(tomorrow.getMonth() + 1).padStart(2, '0')}-${tomorrow.getFullYear()}`;

                // Save to localStorage so plaatsentrekking can find it
                const demoCompetitions = [{
                    datum: datum,
                    dag: getDayName(tomorrow),
                    wedstrijdtype: 'Demo Vrije Gewone',
                    type: 'vrij',
                    aanvang: '08:00',
                    inschrijven: '07:30'
                }];
                localStorage.setItem('demo_competitions', JSON.stringify(demoCompetitions));
                console.log('âœ… Demo wedstrijd opgeslagen in localStorage');

                // Create competition object
                const competition = {
                    datum: datum,
                    wedstrijdtype: 'Demo Vrije Gewone',
                    type: 'vrij',
                    dag: getDayName(tomorrow)
                };

                // Get members for drawing
                const members = await window.dataAPI.getMembers();
                if (members.length < 5) {
                    alert('Je hebt minimaal 5 leden nodig. Voeg eerst demo leden toe!');
                    return;
                }

                // Select random 15 members
                const shuffled = members.sort(() => 0.5 - Math.random());
                const selected = shuffled.slice(0, 15);

                // Create registrations for these members
                for (const member of selected) {
                    await window.dataAPI.addRegistration({
                        name: `${member.firstName} ${member.lastName}`,
                        email: member.email,
                        phone: member.phone || '',
                        competition: `${datum} - Demo Vrije Gewone`,
                        competitionDate: datum,
                        type: 'solo',
                        paymentMethod: Math.random() > 0.5 ? 'qr' : 'onsite',
                        paid: Math.random() > 0.3, // 70% paid, 30% unpaid
                        registeredAt: new Date().toISOString()
                    });
                }

                console.log(`âœ… Created ${selected.length} registrations`);

                // Create draw results
                const availableSpots = Array.from({length: 43}, (_, i) => i + 1);
                const shuffledSpots = availableSpots.sort(() => 0.5 - Math.random());

                const drawResults = selected.map((member, index) => ({
                    name: `${member.firstName} ${member.lastName}`,
                    spot: shuffledSpots[index],
                    isFixed: false
                }));

                // Save draw
                const drawKey = `draw_${datum.replace(/-/g, '_')}`;
                localStorage.setItem(drawKey, JSON.stringify({
                    competition: competition,
                    results: drawResults,
                    timestamp: new Date().toISOString()
                }));

                showAlert(`âœ… Wedstrijd gemaakt met ${drawResults.length} inschrijvingen en trekking voltooid!`);
                console.log('Competition, registrations and draw created:', drawKey);
            } catch (error) {
                console.error('Error creating competition:', error);
                alert('Fout bij maken wedstrijd: ' + error.message);
            }
        }

        // Add random weights
        async function addRandomWeights() {
            try {
                // Find most recent draw
                const drawKeys = Object.keys(localStorage).filter(key => key.startsWith('draw_'));
                if (drawKeys.length === 0) {
                    alert('Geen trekkingen gevonden. Maak eerst een wedstrijd met trekking!');
                    return;
                }

                // Get most recent draw
                const draws = drawKeys.map(key => ({
                    key: key,
                    data: JSON.parse(localStorage.getItem(key))
                })).sort((a, b) => new Date(b.data.timestamp) - new Date(a.data.timestamp));

                const latestDraw = draws[0].data;
                const results = latestDraw.results;

                // Load existing weighings
                let weighings = [];
                const stored = localStorage.getItem('weighings');
                if (stored) {
                    weighings = JSON.parse(stored);
                }

                // Add random weights for each participant
                results.forEach(result => {
                    // Random weight between 0.500 and 5.000 kg
                    const weight = Math.random() * (5.000 - 0.500) + 0.500;

                    weighings.push({
                        id: Date.now() + Math.random(),
                        competitionDate: latestDraw.competition.datum,
                        competitionType: latestDraw.competition.wedstrijdtype,
                        spot: result.spot,
                        name: result.name,
                        weight: parseFloat(weight.toFixed(3)),
                        weighedAt: new Date().toISOString(),
                        weighedBy: 'Demo System',
                        weighGroup: result.spot <= 21 ? 1 : 2
                    });
                });

                // Save weighings
                localStorage.setItem('weighings', JSON.stringify(weighings));

                // Trigger storage event
                window.dispatchEvent(new StorageEvent('storage', {
                    key: 'weighings',
                    newValue: JSON.stringify(weighings)
                }));

                showAlert(`âœ… ${results.length} random gewichten toegevoegd!`);
                console.log('Random weights added:', weighings.length);
            } catch (error) {
                console.error('Error adding random weights:', error);
                alert('Fout bij toevoegen gewichten: ' + error.message);
            }
        }

        // Setup everything at once
        async function setupEverything() {
            if (!confirm('Dit voegt leden, wedstrijd, trekking en gewichten toe. Doorgaan?')) {
                return;
            }

            try {
                await addDemoMembers();
                await new Promise(resolve => setTimeout(resolve, 500));

                await createCompetitionWithDraw();
                await new Promise(resolve => setTimeout(resolve, 500));

                await addRandomWeights();

                showAlert('ðŸŽ‰ Alles is ingesteld! Je kunt nu naar Weging of Live Uitslag gaan.');
            } catch (error) {
                console.error('Error in setup:', error);
                alert('Fout tijdens setup: ' + error.message);
            }
        }

        // Clear all demo data
        function clearAllDemoData() {
            if (!confirm('âš ï¸ Dit verwijdert ALLE demo data (leden, wegingen, trekkingen). Weet je het zeker?')) {
                return;
            }

            try {
                // Clear members
                localStorage.removeItem('mock_members');

                // Clear weighings
                localStorage.removeItem('weighings');

                // Clear demo competitions
                localStorage.removeItem('demo_competitions');

                // Clear registrations
                localStorage.removeItem('mock_registrations');

                // Clear draws
                const drawKeys = Object.keys(localStorage).filter(key => key.startsWith('draw_'));
                drawKeys.forEach(key => localStorage.removeItem(key));

                showAlert('âœ… Alle demo data verwijderd!');
                console.log('All demo data cleared');
            } catch (error) {
                console.error('Error clearing data:', error);
                alert('Fout bij verwijderen: ' + error.message);
            }
        }

        // Get day name
        function getDayName(date) {
            const days = ['Zondag', 'Maandag', 'Dinsdag', 'Woensdag', 'Donderdag', 'Vrijdag', 'Zaterdag'];
            return days[date.getDay()];
        }

        // Show alert
        function showAlert(message) {
            const alert = document.getElementById('alertSuccess');
            document.getElementById('alertMessage').textContent = message;
            alert.classList.add('show');

            setTimeout(() => {
                alert.classList.remove('show');
            }, 5000);
        }
    </script>
</body>
</html>
