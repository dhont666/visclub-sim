<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Version Check - Visvergunning</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #2c3e50; }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px 10px 0;
        }
        button:hover { background: #0056b3; }
        .step {
            background: #e9ecef;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        .code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Server Version Check - visvergunning.html</h1>
        <p>Deze tool controleert welke versie van visvergunning.html op de server staat.</p>

        <button onclick="checkVersion()">‚ñ∂ Check Server Version</button>
        <button onclick="window.location.reload()">üîÑ Refresh</button>

        <div id="results"></div>

        <div id="instructions" style="display:none;">
            <h2>üì§ Upload Instructies</h2>

            <div class="step">
                <h3>Stap 1: Lokale File Locatie</h3>
                <p>De NIEUWE, GOEDE versie staat op:</p>
                <pre>C:\Users\kevin\Desktop\Viswebsite2\vissersclub-sim-website\visvergunning.html</pre>
            </div>

            <div class="step">
                <h3>Stap 2: Log in op Cloud86 Plesk</h3>
                <p>Ga naar: <a href="https://cloud86.nl" target="_blank">cloud86.nl</a></p>
            </div>

            <div class="step">
                <h3>Stap 3: File Manager</h3>
                <p>Klik op: <span class="code">File Manager</span> ‚Üí <span class="code">public_html</span></p>
            </div>

            <div class="step">
                <h3>Stap 4: Upload</h3>
                <p>1. Klik op <span class="code">Upload Files</span></p>
                <p>2. Selecteer: <span class="code">C:\Users\kevin\Desktop\Viswebsite2\vissersclub-sim-website\visvergunning.html</span></p>
                <p>3. Wacht tot upload compleet is</p>
                <p>4. <strong>Klik op "Overwrite" als gevraagd</strong> (dit is belangrijk!)</p>
            </div>

            <div class="step">
                <h3>Stap 5: Clear Browser Cache</h3>
                <p>Druk op: <span class="code">Ctrl + Shift + R</span> (Windows) of <span class="code">Cmd + Shift + R</span> (Mac)</p>
                <p>Dit forceert een verse download van de file</p>
            </div>

            <div class="step">
                <h3>Stap 6: Test Opnieuw</h3>
                <p>Klik op de "Check Server Version" knop bovenaan deze pagina</p>
            </div>
        </div>
    </div>

    <script>
        async function checkVersion() {
            const resultsDiv = document.getElementById('results');
            const instructionsDiv = document.getElementById('instructions');

            resultsDiv.innerHTML = '<div class="info">‚è≥ Checking server version...</div>';

            try {
                // Fetch the HTML file with cache-busting
                const response = await fetch('https://www.visclubsim.be/visvergunning.html?nocache=' + Date.now(), {
                    cache: 'no-store'
                });

                const html = await response.text();

                // Check for markers that indicate new vs old version
                const hasNewHandler = html.includes('PERMIT FORM HANDLER INITIALIZED');
                const hasOldHandler = html.includes('Custom permit handler attached with capture:true (visvergunning.html)');
                const loadsScriptJs = html.includes('<script src="script.js">');
                const loadsConfigJs = html.includes('<script src="config.js">');

                let result = '<h2>üìä Check Results</h2>';

                if (hasNewHandler) {
                    result += '<div class="success">‚úÖ SERVER HAS THE NEW VERSION!</div>';
                    result += '<p><strong>Good signs detected:</strong></p>';
                    result += '<ul>';
                    result += '<li>‚úÖ Contains: "PERMIT FORM HANDLER INITIALIZED"</li>';
                    result += '<li>‚úÖ Self-contained handler found</li>';
                    result += '</ul>';

                    result += '<div class="info">';
                    result += '<h3>üß™ Next Steps:</h3>';
                    result += '<ol>';
                    result += '<li>Open: <a href="https://www.visclubsim.be/visvergunning.html" target="_blank">https://www.visclubsim.be/visvergunning.html</a></li>';
                    result += '<li>Press <span class="code">Ctrl + Shift + R</span> to clear cache</li>';
                    result += '<li>Open Console (F12)</li>';
                    result += '<li>Look for: <span class="code">=== PERMIT FORM HANDLER INITIALIZED ===</span></li>';
                    result += '<li>Fill and submit form</li>';
                    result += '<li>Should see: <span class="code">Custom handler running (capture phase)</span></li>';
                    result += '</ol>';
                    result += '</div>';

                    instructionsDiv.style.display = 'none';
                } else {
                    result += '<div class="error">‚ùå SERVER HAS THE OLD VERSION!</div>';
                    result += '<p><strong>Problems detected:</strong></p>';
                    result += '<ul>';
                    result += '<li>‚ùå Missing: "PERMIT FORM HANDLER INITIALIZED"</li>';
                    if (loadsScriptJs) result += '<li>‚ùå Still loads script.js (old approach)</li>';
                    if (loadsConfigJs) result += '<li>‚ùå Still loads config.js (old approach)</li>';
                    result += '</ul>';

                    result += '<div class="warning">';
                    result += '<h3>‚ö†Ô∏è Action Required:</h3>';
                    result += '<p><strong>You need to upload the NEW version!</strong></p>';
                    result += '<p>See upload instructions below.</p>';
                    result += '</div>';

                    instructionsDiv.style.display = 'block';
                }

                // Show file info
                result += '<h3>üìÑ File Details:</h3>';
                result += '<pre>';
                result += 'Response Status: ' + response.status + '\n';
                result += 'Content-Type: ' + response.headers.get('content-type') + '\n';
                result += 'Content-Length: ' + (html.length / 1024).toFixed(2) + ' KB\n';
                result += 'Last-Modified: ' + (response.headers.get('last-modified') || 'Unknown') + '\n';
                result += '</pre>';

                // Show snippet of the script section
                const scriptMatch = html.match(/<script>[\s\S]{0,500}/);
                if (scriptMatch) {
                    result += '<h3>üìù Script Section Preview:</h3>';
                    result += '<pre>' + escapeHtml(scriptMatch[0].substring(0, 400)) + '...</pre>';
                }

                resultsDiv.innerHTML = result;

            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Error checking server: ${error.message}
                    </div>
                    <p>Make sure the file exists on the server.</p>
                `;
                instructionsDiv.style.display = 'block';
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Auto-check on load
        window.addEventListener('load', () => {
            setTimeout(checkVersion, 500);
        });
    </script>
</body>
</html>
